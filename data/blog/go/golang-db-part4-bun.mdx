---
title: 'Connect to SQL Database with Bun'
date: '2022-09-22'
tags: ['go', 'database', 'orm', 'bun']
draft: false
summary: '‡πÅ‡∏ô‡∏∞‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Bun ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° SQL Builder + sqlx + Relations ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô'
# images: ['/api/social-image/blog/go/go-fundamentals.jpg']
---

# Connect to SQL Database with Bun

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏ä‡∏≠‡∏ö‡πÉ‡∏ä‡πâ ORM ‡πÄ‡∏ä‡πà‡∏ô [GORM](https://somprasongd.work/blog/go/golang-db-part3) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏°‡∏µ features ‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Raw SQL ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ [database/sql](https://somprasongd.work/blog/go/golang-db-part1) ‡∏Å‡πá‡∏à‡∏∞‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡∏ï‡∏≠‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Go types ‡∏ï‡πà‡∏≤‡∏á‡πÜ (`structs, maps, slices, and scalars`) ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà [sqlx](https://somprasongd.work/blog/go/golang-db-part2) ‡∏°‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ

‡πÅ‡∏ï‡πà‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Raw SQL ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡∏¢‡∏≤‡∏Å ‡∏à‡∏∂‡∏á‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ SQL builder ‡∏°‡∏≤‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á SQL ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÅ‡∏ó‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏à‡∏≠‡∏°‡∏≤‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏∂‡πà‡∏á ‡∏Ñ‡∏∑‡∏≠ [Bun](https://bun.uptrace.dev/) ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ ‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡∏ß‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏°‡∏µ SQL builder ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô sqlx ‡πÅ‡∏ñ‡∏°‡∏¢‡∏±‡∏á‡∏°‡∏µ Model Relations ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô ORM ‡∏î‡πâ‡∏ß‡∏¢

## ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go
2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏†‡∏≤‡∏©‡∏≤ SQL

## ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤

- Bun ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Model
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Queries
- Table Relationships
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Transactions

## Bun ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

[Bun](https://bun.uptrace.dev/) ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô Lightweight Golang ORM ‡πÅ‡∏ö‡∏ö **SQL-first** ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PostgreSQL, MySQL, MSSQL ‡πÅ‡∏•‡∏∞ SQLite

‡πÇ‡∏î‡∏¢‡∏ï‡∏±‡∏ß Bun ‡∏à‡∏∞‡πÄ‡∏ô‡πâ‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL ‡∏ã‡∏∂‡πà‡∏á Bun ‡∏ú‡πà‡∏≤‡∏ô [Query Builder](https://bun.uptrace.dev/guide/queries.html) ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å ORM ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ñ‡∏∑‡∏≠ Query Builder ‡∏Ç‡∏≠‡∏á Bun ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL queries ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô

- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL ‡∏ú‡πà‡∏≤‡∏ô database/sql

```go
res, err := db.ExecContext(ctx, `WITH regional_sales AS (
    SELECT region, SUM(amount) AS total_sales
    FROM orders
    GROUP BY region
), top_regions AS (
    SELECT region
    FROM regional_sales
    WHERE total_sales > (SELECT SUM(total_sales)/10 FROM regional_sales)
)
SELECT region,
       product,
       SUM(quantity) AS product_units,
       SUM(amount) AS product_sales
FROM orders
WHERE region IN (SELECT region FROM top_regions)
GROUP BY region, product`)
```

- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö Bun's query builder

```go
regionalSales := db.NewSelect().
	ColumnExpr("region").
	ColumnExpr("SUM(amount) AS total_sales").
	TableExpr("orders").
	GroupExpr("region")

topRegions := db.NewSelect().
	ColumnExpr("region").
	TableExpr("regional_sales").
	Where("total_sales > (SELECT SUM(total_sales) / 10 FROM regional_sales)")

err := db.NewSelect().
	With("regional_sales", regionalSales).
	With("top_regions", topRegions).
	ColumnExpr("region").
	ColumnExpr("product").
	ColumnExpr("SUM(quantity) AS product_units").
	ColumnExpr("SUM(amount) AS product_sales").
	TableExpr("orders").
	Where("region IN (SELECT region FROM top_regions)").
	GroupExpr("region").
	GroupExpr("product").
	Scan(ctx)
```

‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏≠‡∏á Lightweight Golang ORM ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ features ‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà ORM ‡∏ï‡∏±‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏°‡∏µ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ automatic migrations, optimizer/index/comment hints, ‡πÅ‡∏•‡∏∞ database resolver

## ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô PostgreSQL ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ú‡πà‡∏≤‡∏ô docker

```bash
docker run \
--name bun-db \
-p 2345:5432 \
-e POSTGRES_PASSWORD=mysecretpassword \
-e POSTGRES_DB=bun-db \
-v pg-data-bun:/var/lib/postgresql/data \
-d postgres:14-alpine
```

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà

```bash
mkdir -p godb-bun
cd godb-bun
go mod init godb/bun
```

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `main.go`

```go
package main

func main() {

}
```

‡∏ã‡∏∂‡πà‡∏á Bun ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô [database/sql](https://pkg.go.dev/database/sql) ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á connection ‡∏à‡∏≤‡∏Å `sql.DB` ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô [PostgreSQL](https://www.postgresql.org/) ‡∏à‡∏∂‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ driver ‡∏Ç‡∏≠‡∏á PostgreSQL ‡∏î‡πâ‡∏ß‡∏¢

```go
package main

import (
	"database/sql"

	"github.com/uptrace/bun/driver/pgdriver"
)

func main() {
	connectDB()
}

func connectDB() {
	dsn := "postgres://postgres:mysecretpassword@localhost:5433/bun-db?sslmode=disable"

	sqldb := sql.OpenDB(pgdriver.NewConnector(pgdriver.WithDSN(dsn)))
}
```

‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏≠‡∏≤ connection ‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô `bun.DB` ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ PostgreSQL [dialect](https://bun.uptrace.dev/guide/drivers.html) ‡∏Ç‡∏≠‡∏á Bun

```diff
package main

import (
	"database/sql"

+	"github.com/uptrace/bun"
+	"github.com/uptrace/bun/dialect/pgdialect"
	"github.com/uptrace/bun/driver/pgdriver"
)

func main() {
	db := connectDB()
+	defer db.Close()

}

-func connectDB() {
+func connectDB() *bun.DB {
	dsn := "postgres://postgres:mysecretpassword@localhost:5433/bun-db?sslmode=disable"

	sqldb := sql.OpenDB(pgdriver.NewConnector(pgdriver.WithDSN(dsn)))

+	db := bun.NewDB(sqldb, pgdialect.New())

+	return db
}
```

‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `Ping` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á database/sql

```diff
func connectDB() {
	dsn := "postgres://postgres:mysecretpassword@localhost:5433/bun-db?sslmode=disable"

	sqldb := sql.OpenDB(pgdriver.NewConnector(pgdriver.WithDSN(dsn)))

	db := bun.NewDB(sqldb, pgdialect.New())

+ err := db.Ping()
+	if err != nil {
+		panic(err)
+	}

  return db
}
```

### ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ database/sql ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á

```go
func main() {
	db := connectDB()
	defer db.Close()

	ctx := context.Background()

	querySqlDB(ctx, db)
}

func querySqlDB(ctx context.Context, db *bun.DB) {
	// execute queries using database/sql
	res, err := db.ExecContext(ctx, "SELECT 1")
	if err != nil {
		panic(err)
	}
	fmt.Printf("res: %v\n", res)

	var num int
	err = db.QueryRowContext(ctx, "SELECT 1").Scan(&num)
	if err != nil {
		panic(err)
	}
	fmt.Printf("num: %v\n", num)
}
```

- ‡πÉ‡∏ä‡πâ Bun's query builder ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ

```go
func main() {
	db := connectDB()
	defer db.Close()

	ctx := context.Background()

	querySqlDB(ctx, db)
}

func queryBunDB(ctx context.Context, db *bun.DB) {
  // using Bun's query builder
	res, err := db.NewSelect().ColumnExpr("1").Exec(ctx)
	if err != nil {
		panic(err)
	}
	fmt.Printf("res: %v\n", res)

	var num int
	err = db.NewSelect().ColumnExpr("1").Scan(ctx, &num)
	if err != nil {
		panic(err)
	}
	fmt.Printf("num: %v\n", num)
}
```

‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á queries log

‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á SQL queries ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á `bundebug` ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö [query hook](https://bun.uptrace.dev/guide/hooks.html#query-hooks)

```bash
go get github.com/uptrace/bun/extra/bundebug
```

‡πÄ‡∏û‡∏¥‡πà‡∏° query hook ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á SQL queries ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤

```diff
import (
	// ...
+	"github.com/uptrace/bun/extra/bundebug"
)

func connectDB() *bun.DB {
	dsn := "postgres://postgres:postgres@localhost:5433/godb-bun?sslmode=disable"

	sqldb := sql.OpenDB(pgdriver.NewConnector(pgdriver.WithDSN(dsn)))

	db := bun.NewDB(sqldb, pgdialect.New())

+	db.AddQueryHook(bundebug.NewQueryHook())

  err := db.Ping()
	if err != nil {
		panic(err)
	}

	return db
}
```

‡πÅ‡∏ï‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡∏π ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ queries ‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏•‡∏¢ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° `WithVerbose` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô options ‡∏î‡πâ‡∏ß‡∏¢

```go
db.AddQueryHook(bundebug.NewQueryHook(bundebug.WithVerbose(true)))
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏à‡∏∞‡∏°‡∏µ query ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß

```bash
[bun]  12:20:36.695   SELECT                  510¬µs  SELECT 1
```

## ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Model

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å Bun ‡πÄ‡∏õ‡πá‡∏ô ORM ‡∏à‡∏∂‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ mapping ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô struct ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ model ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡πÅ‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô struct ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ tags `bun` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

### ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Table names

Bun ‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÅ‡∏•‡∏∞ alias ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á struct ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô underscore ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ pluralizes ‡πÄ‡∏ä‡πà‡∏ô struct ‡∏ä‡∏∑‡πà‡∏≠ `ProductCategory` ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô `product_categories` ‡πÅ‡∏•‡∏∞ alias ‡πÄ‡∏õ‡πá‡∏ô `product_category`

‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ tag `bun:"table:table_name"` ‡πÅ‡∏•‡∏∞ alias ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ tag `bun:"alias:table_alias"` ‡πÄ‡∏ä‡πà‡∏ô

```go
type Task struct {
	bun.BaseModel `bun:"table:mytasks,alias:t"`
}
```

### ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Column names

‡∏ï‡∏±‡∏ß Bun ‡πÄ‡∏≠‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ fileds ‡∏Ç‡∏≠‡∏á struct ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô column names ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ underscore ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ tag `bun:"column_name"`

```go
type Task struct {
  ID         int64  `bun:"id"`
  Text       string `bun:"title"`
  Completed  bool   `bun:"is_done"`
}
```

### ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Column types

‡∏ï‡∏±‡∏ß Bun ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á column types ‡∏ï‡∏≤‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á fileds ‡πÉ‡∏ô struct ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô `string` ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô `varchar` ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ tag `bun:"type:column_type"`

```diff
type Task struct {
- ID         int64  `bun:"id"`
+ ID         int64  `bun:"id,type:integer"`
  Text       string `bun:"title"`
  Completed  bool   `bun:"is_done"`
}
```

### ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Primary key

‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ struct field ‡πÑ‡∏´‡∏ô‡πÄ‡∏õ‡πá‡∏ô primary key ‡∏à‡∏∞‡πÉ‡∏ä‡πâ tag `bun:",pk"` ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö `bun:",autoincrement"` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î column type ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô PostgreSQL ‡πÄ‡∏õ‡πá‡∏ô `serial` ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô MySQL ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô `autoincrement` ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô MSSQL ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô `identity`

```diff
type Task struct {
- ID         int64  `bun:"id,type:integer"`
+ ID         int64  `bun:"id,pk,autoincrement"`
  Text       string `bun:"title"`
  Completed  bool   `bun:"is_done"`
}
```

<aside>
üí° `bun:",pk"` ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ `notnull` ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°

</aside>

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏≤ NULL

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ SQL `NULL` ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á fileds ‡πÉ‡∏ô struct ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô pointer ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ sql.Null* (*‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡πÅ‡∏ó‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô

```go
type Item struct {
    Active *bool
    // or
    Active sql.NullBool
}
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ `(*bool)(nil)` ‡∏°‡∏≤ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô `NULL`

**Go zero values and NULL**

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ zero value ‡∏Ç‡∏≠‡∏á Go ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô NULL ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ tag `bun:",nullzero"` ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô

```diff
type Task struct {
  ID         int64  `bun:"id,pk,autoincrement"`
- Text       string `bun:"title"`
+ Text       string `bun:"title,nullzero"`
  Completed  bool   `bun:"is_done"`
}
```

‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Text ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô NULL ‡πÅ‡∏ó‡∏ô

**NOT NULL**

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ column ‡πÄ‡∏õ‡πá‡∏ô NOT NULL ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ tag `bun:",notnull"` ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô

```diff
type Task struct {
  ID         int64  `bun:"id,pk,autoincrement"`
  Text       string `bun:"title,nullzero"`
- Completed  bool   `bun:"is_done"`
+ Completed  bool   `bun:"is_done,notnull"`
}
```

### ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ DEFAULT

‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î default ‡πÉ‡∏ô SQL ‡∏à‡∏∞‡πÉ‡∏ä‡πâ tag `nullzero`,¬†`notnull` ‡πÅ‡∏•‡∏∞`default` ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô

```diff
type Task struct {
  ID         int64  `bun:"id,pk,autoincrement"`
- Text       string `bun:"title,nullzero"`
+ Text       string `bun:"title,nullzero,notnull,default:'untitled'"`
- Completed  bool   `bun:"is_done,notnull"`
+ Completed  bool   `bun:"is_done,notnull,default:false"`
}

err := db.NewCreateTable().Model((*Task)(nil)).Exec(ctx)
```

‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô

```sql
CREATE TABLE "tasks" (
  "id"      BIGSERIAL NOT NULL,
  "title"   VARCHAR NOT NULL DEFAULT 'untitled',
  "is_done" BOOLEAN NOT NULL DEFAULT false,
  PRIMARY KEY ("id")
)
```

**Automatic timestamps**

‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏°‡∏µ columns ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Bun ‡∏ó‡∏≥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≠‡∏ô `INSERT` ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

```go
type Task struct {
  ID         int64  `bun:"id,pk,autoincrement"`
  Text       string `bun:"title,nullzero,notnull,default:'untitled'"`
  Completed  bool   `bun:"is_done,notnull,default:false"`

  CreatedAt time.Time `bun:",nullzero,notnull,default:current_timestamp"`
	UpdatedAt time.Time `bun:",nullzero,notnull,default:current_timestamp"`
}

res, err := db.NewCreateTable().Model((*Task)(nil)).Exec(ctx)
```

<aside>
üí° ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å update time ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `UpdatedAt bun.NullTime` ‡πÅ‡∏ó‡∏ô

</aside>

## ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Queries

Bun ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á queries ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å `bun.DB`, `bun.Tx` ‡∏´‡∏£‡∏∑‡∏≠ `bun.Conn` ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL ‡∏•‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡πÜ ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `db.ExecContext()` ‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Bun's query builder ‡πÅ‡∏ó‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ CRUD ‡∏à‡∏∞‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

- **`db.NewSelect` ‚Üí** ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `SELECT`
- **`db.NewInsert` ‚Üí** ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `INSERT`
- **`db.NewUpdate` ‚Üí** ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `UPDATE`
- **`db.NewDelete` ‚Üí** ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `DELETE`

‡πÅ‡∏•‡∏∞‡∏ó‡∏∏‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ `Exce()` ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á execute query ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÑ‡∏î‡πâ `sql.Result` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô

```go
result, err := db.NewInsert().Model(&task).Exec(ctx)
```

‡πÅ‡∏ï‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `db.NewSelect` ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ `Scan()` ‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞ `sql.Result` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ

```go
err := db.NewSelect().Model(&task).Where("id = 1").Scan(ctx)

// ‡∏´‡∏£‡∏∑‡∏≠
err := db.NewSelect().Model((*Task)(nil)).Where("id = 1").Scan(ctx, &user)
```

‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏£‡∏ñ scan ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö

- struct
- `map[string]interface{}`
- scalar types
- slices ‡∏Ç‡∏≠‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô

<aside>
üí° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ `bun.IDB` ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô interface ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏ô `bun.DB`, `bun.Tx` ‡∏´‡∏£‡∏∑‡∏≠ `bun.Conn` ‡πÑ‡∏î‡πâ

</aside>

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Database

‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÉ‡∏ä‡πâ `db.NewInsert` ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏∏ `Model(&struct)` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ query builder ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á, ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤ DEFAULT ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô model

```go
task := Task{
	Text: "todo 1",
}

result, err := db.NewInsert().Model(&task).Exec(ctx)

// INSERT INTO "tasks"
// ("id", "title", "is_done", "created_at", "updated_at")
// VALUES
// (DEFAULT, 'todo 1', DEFAULT, DEFAULT, DEFAULT)
// RETURNING "id", "is_done", "created_at", "updated_at"
```

‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ß‡πà‡∏≤ Bun ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° return ‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô `&struct` ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏≠‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `database/sql` ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏°‡∏≤‡∏Å‡πÜ

```go
fmt.Println(task)
// {1 todo 1 false 2022-09-14 13:42:13.36677 +0700 +07 2022-09-14 13:42:13.36677 +0700 +07}
```

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ô‡∏±‡πâ‡∏ô ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å¬†`result.RowsAffected()` ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤¬†`0`

```go
func createTask(ctx context.Context, db *bun.DB, task *Task) error {
	result, err := db.NewInsert().Model(task).Exec(ctx)
	if err != nil {
		panic(err)
	}

	affected, err := result.RowsAffected()
	if err != nil {
		return err
	}

	if affected <= 0 {
		return errors.New("cannot insert")
	}
	return nil
}
```

### ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Database

‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÉ‡∏ä‡πâ `db.NewSelect` ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡πÉ‡∏™‡πà `Model(&sliceOfStruct)` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Bun ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏´‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á model ‡∏≠‡∏∞‡πÑ‡∏£

```go
func readTask(ctx context.Context, db *bun.DB) ([]Task, error) {
	tasks := []Task{}
	err := db.NewSelect().Model(&tasks).Scan(ctx)
	if err != nil {
		return nil, err
	}
	return tasks, err
}
```

**‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç**

‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ `Where` ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô

- ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤ sql ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ `select * from tasks where is_done = true`
- ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à `select * from tasks where is_done = false`

‡∏ã‡∏∂‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô parameter ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ [placeholders](https://bun.uptrace.dev/guide/placeholders.html) (`?`)

```go
func readTaskByStatus(ctx context.Context, db *bun.DB, status *bool) ([]Task, error) {
	tasks := []Task{}

	q := db.NewSelect().Model(&tasks)

	if status != nil {
		q.Where("is_done = ?", *status)
	}

	err := q.Scan(ctx)

	if err != nil {
		return nil, err
	}
	return tasks, err
}
```

**‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Primary Key**

‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å Primary Key ‡∏à‡∏∞‡πÉ‡∏ä‡πâ `WherePK` ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏Ñ‡πà 1 row ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ `Model(&struct)` ‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏°‡∏≤

```go
func getTaskById(ctx context.Context, db *bun.DB, id int64) (*Task, error) {
	task := &Task{
		ID: id,
	}
	err := db.NewSelect().Model(task).WherePK().Scan(ctx)

	if err != nil {
		return nil, err
	}
	return task, err
}
```

‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤ primary key ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ error ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

```go
if err != nil {
	if err.Error() == sql.ErrNoRows.Error() {
		return nil, nil
	}
	return nil, err
}
```

**‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö Pagination**

‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏∞ 10 rows ‡πÉ‡∏ô SQL ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ `LIMIT X OFFSET Y`

```sql
SELECT * FROM tasks ORDER BY id ASC LIMIT 10 OFFSET 0; -- first page
SELECT * FROM tasks ORDER BY id ASC LIMIT 10 OFFSET 10; -- second page
SELECT * FROM tasks ORDER BY id ASC LIMIT 10 OFFSET 20; -- third page
```

‡πÉ‡∏ô Bun ‡∏Å‡πá‡∏°‡∏µ `Limit` ‡πÅ‡∏•‡∏∞ `Offset` ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô

```go
func readTaskPaging(ctx context.Context, db *bun.DB, page int) ([]Task, error) {
	if page < 1 {
		page = 1
	}
	tasks := []Task{}
	err := db.NewSelect().
		Model(&tasks).
		Limit(10).
		Offset((page - 1) * 10).
		Scan(ctx)
	if err != nil {
		return nil, err
	}
	return tasks, err
}

// SELECT "task"."id", "task"."title", "task"."is_done", "task"."created_at", "task"."updated_at" FROM "tasks" AS "task" LIMIT 10
```

**‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô rows**

‡πÉ‡∏ô Bun ‡∏°‡∏µ `Count` ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `count(*)`

```go
count, err := db.NewSelect().Model((*Task)(nil)).Count(ctx)
```

‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏°‡∏≤‡∏Å‡πÜ ‡∏Ñ‡∏∑‡∏≠ Bun ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ select ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô `Scan` ‡πÄ‡∏õ‡πá‡∏ô `ScanAndCount` ‡∏ï‡∏±‡∏ß Bun ‡∏à‡∏∞‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á

```go
func readTaskPagingAndCount(ctx context.Context, db *bun.DB, page int) ([]Task, int, error) {
	if page < 1 {
		page = 1
	}
	tasks := []Task{}
	count, err := db.NewSelect().
		Model(&tasks).
		Limit(10).
		Offset((page - 1) * 10).
		ScanAndCount(ctx)
	if err != nil {
		return nil, 0, err
	}
	return tasks, count, err
}

// SELECT "task"."id", "task"."title", "task"."is_done", "task"."created_at", "task"."updated_at" FROM "tasks" AS "task" LIMIT 10
// SELECT count(*) FROM "tasks" AS "task"
```

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÉ‡∏ä‡πâ `db.NewUpdate` ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏ `Model` ‡∏Å‡∏±‡∏ö `Where` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢

```go
func updateTask(ctx context.Context, db *bun.DB, task *Task) error {
	result, err := db.NewUpdate().Model(task).WherePK().Exec(ctx)
	if err != nil {
		panic(err)
	}
	affected, err := result.RowsAffected()
	if err != nil {
		return err
	}

	if affected <= 0 {
		return errors.New("no row to update")
	}
	return nil
}
// UPDATE "tasks" AS "task" SET "title" = 'todo 1', "is_done" = TRUE, "created_at" = '2022-09-14 06:01:03.90468+00:00', "updated_at" = '2022-09-14 06:01:03.90468+00:00' WHERE ("task"."id" = 1)
```

‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏û‡∏ö‡∏ß‡πà‡∏≤ Bun ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ update ‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å columns ‡∏à‡∏≤‡∏Å fields ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ (zero value) ‡∏ã‡∏∂‡πà‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏≠‡∏≤ fields ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô zero value ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° `OmitZero` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏ö‡∏ô‡∏ô‡∏µ‡πâ

```go
result, err := db.NewUpdate().
		Model(task).
		OmitZero().
		WherePK().
		Exec(ctx)
```

‡πÅ‡∏ï‡πà‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô boolean ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ zero value ‡πÄ‡∏õ‡πá‡∏ô false ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô false ‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ `OmitZero` ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏ columns ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ update ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `Column`

```go
result, err := db.NewUpdate().
		Model(task).
		Column("is_done").
		WherePK().
		Exec(ctx)

// UPDATE "tasks" AS "task" SET "is_done" = TRUE WHERE ("task"."id" = 1)
```

<aside>
üí° ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å columns ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏•‡∏±‡∏á update ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° `Returning("*")` ‡∏Å‡πà‡∏≠‡∏ô `Exec`

</aside>

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ automatic update time

‡πÉ‡∏ô Bun ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á Update ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤ updated_at ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡πÑ‡∏î‡πâ 2 ‡∏ß‡∏¥‡∏ò‡∏µ ‡∏Ñ‡∏∑‡∏≠

1. ‡πÉ‡∏ä‡πâ SetColumn ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á updated_at ‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Update

   ```go
   result, err := db.NewUpdate().
   		Model(task).
   		Column("is_done").
   		SetColumn("updated_at", "DEFAULT").
   		WherePK().
   		Exec(ctx)
   ```

2. ‡πÉ‡∏ä‡πâ Model hooks ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ \***\*[BeforeAppendModel](https://bun.uptrace.dev/guide/hooks.html#beforeappendmodel)\*\*** ‡∏°‡∏≤‡∏Ñ‡∏≠‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô insert ‡πÅ‡∏•‡∏∞ update ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ implement `bun.BeforeAppendModelHook` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô model ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

   ```go
   type Task struct {
     ID         int64  `bun:"id,pk,autoincrement"`
     Text       string `bun:"title,nullzero,notnull,default:'untitled'"`
     Completed  bool   `bun:"is_done,notnull,default:false"`

     CreatedAt time.Time `bun:",nullzero,notnull,default:current_timestamp"`
   	UpdatedAt time.Time `bun:",nullzero,notnull,default:current_timestamp"`
   }

   var _ bun.BeforeAppendModelHook = (*Task)(nil)

   func (m *Model) BeforeAppendModel(ctx context.Context, query bun.Query) error {
   	switch query.(type) {
   	case *bun.InsertQuery:
   		m.CreatedAt = time.Now()
       m.UpdatedAt = time.Now()
   	case *bun.UpdateQuery:
   		m.UpdatedAt = time.Now()
   	}
   	return nil
   }
   ```

‡πÅ‡∏ï‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏£‡∏Å ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ Model ‡∏°‡∏µ dependencies ‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢

### ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÉ‡∏ä‡πâ `db.NewDelete` ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏ `Model` ‡∏Å‡∏±‡∏ö `Where` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢

```go
func deleteTask(ctx context.Context, db *bun.DB, id int64) error {
	_, err := db.NewDelete().Model((*Task)(nil)).Where("id = ?", id).Exec(ctx)

	return err
}
// DELETE FROM "tasks" AS "task" WHERE (id = 1)
```

**‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö Soft delete**

‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Soft delete ‡∏Ñ‡∏∑‡∏≠ ‡πÄ‡∏°‡∏∑‡πà‡∏≠ `db.NewDelete` ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏´‡∏•‡∏±‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∑‡∏≠

- ‡πÄ‡∏û‡∏¥‡πà‡∏° column `deleted_at timestamptz` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡πÇ‡∏î‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏•‡∏ö ‡∏à‡∏∞‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏•‡∏á `deleted_at`

```sql
UPDATE tasks SET deleted_at = now() WHERE id = 1
```

- ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å `deleted_at IS NULL`

```sql
SELECT * FROM tasks WHERE deleted_at IS NULL
```

‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ ‡∏Ñ‡∏∑‡∏≠ ‡πÉ‡∏ô model ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° field `DeletedAt` ‡πÅ‡∏•‡∏∞‡πÉ‡∏™‡πà tag `soft_delete` ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢

```diff
type Task struct {
	ID        int64     `bun:"id,pk,autoincrement"`
	Text      string    `bun:"title,nullzero,notnull,default:'untitled'"`
	Completed bool      `bun:"is_done,notnull,default:false"`
	CreatedAt time.Time `bun:",nullzero,notnull,default:current_timestamp"`
	UpdatedAt time.Time `bun:",nullzero,notnull,default:current_timestamp"`
+ DeletedAt time.Time `bun:",soft_delete,nullzero"`
}
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏•‡∏ö

```go
_, err := db.NewDelete().Model((*Task)(nil)).Where("id = ?", 1).Exec(ctx)

// UPDATE tasks SET deleted_at = current_timestamp WHERE id = 1
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

```go
err := db.NewSelect().Model(&tasks).Scan(ctx)

// SELECT * FROM tasks WHERE deleted_at IS NULL
```

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà soft-deleted ‡πÑ‡∏õ ‡πÉ‡∏ä‡πâ `WhereDeleted()`

```go
err := db.NewSelect().Model(&tasks).WhereDeleted().Scan(ctx)

// SELECT * FROM tasks WHERE deleted_at IS NOT NULL
```

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÉ‡∏ä‡πâ `WhereAllWithDeleted()`

```go
err := db.NewSelect().Model(&tasks).WhereAllWithDeleted().Scan(ctx)

// SELECT * FROM tasks
```

‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà soft-deleted ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÉ‡∏ä‡πâ `ForceDelete()`

```go
_, err := db.NewDelete().Model((*Task)(nil)).Where("id = ?", 1).ForceDelete().Exec(ctx)

// DELETE FROM tasks WHERE id = 1 AND deleted_at IS NOT NULL
```

## Model Relationships

‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å Bun ‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏õ‡πá‡∏ô ORM ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° ralation ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á models ‡πÑ‡∏î‡πâ ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô join ‡∏´‡∏£‡∏∑ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏™‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô model ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢

- **has-one** ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏ö‡∏ö 1-to-1 ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô model ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏°‡πà

```go
type Profile struct {
	ID     int64 `bun:",pk"`
	Lang   string
	UserID int64
}

type User struct {
	ID      int64 `bun:",pk"`
	Name    string
	Profile *Profile `bun:"rel:has-one,join:id=user_id"`
}
```

- **belongs-to** ‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô model ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏π‡∏Å ‡∏ß‡πà‡∏≤ model ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

```go
type Profile struct {
	ID     int64 `bun:",pk"`
	Lang   string
	UserID int64
	User   *User `bun:"rel:belongs-to,join=user_id=id"`
}

type User struct {
	ID      int64 `bun:",pk"`
	Name    string
	Profile *Profile `bun:"rel:has-one,join:id=user_id"`
}
```

- **has-many** ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏ö‡∏ö 1-to-many ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô model ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏°‡πà

```go
type Task struct {
	ID        int64 `bun:",pk"`
	Text      string
  Completed bool
	UserID    int64
	User      *User `bun:"rel:belongs-to,join=user_id=id"`
}

type User struct {
	ID      int64   `bun:",pk"`
	Name    string
	Tasks   []*Task `bun:"rel:has-many,join:id=user_id"`
}
```

- **many-to-many** ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏ö‡∏ö many-to-many ‡∏Ç‡∏≠‡∏á 2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° 2 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á model ‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ register model ‡∏ô‡∏µ‡πâ‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏î‡πâ‡∏ß‡∏¢ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (`Order`) 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (`Item`) ‡πÅ‡∏•‡∏∞‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡∏π‡∏Å‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô `Order` ‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `OrderToItem` ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° `Order` ‡∏Å‡∏±‡∏ö `Item` ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô

```go
func init() {
    // Register many to many model so bun can better recognize m2m relation.
    // This should be done before you use the model for the first time.
    db.RegisterModel((*OrderToItem)(nil))
}

type Order struct {
	ID    int64  `bun:",pk"`
    // Order and Item in join:Order=Item are fields in OrderToItem model
	Items []Item `bun:"m2m:order_to_items,join:Order=Item"`
}

type Item struct {
	ID int64 `bun:",pk"`
}

type OrderToItem struct {
	OrderID int64  `bun:",pk"`
	Order   *Order `bun:"rel:belongs-to,join:order_id=id"`
	ItemID  int64  `bun:",pk"`
	Item    *Item  `bun:"rel:belongs-to,join:item_id=id"`
}
```

## ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Transactions

‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏ö‡πÉ‡∏ô statement ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á insert ‡∏´‡∏•‡∏≤‡∏¢‡πÜ statement ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á insert, update ‡πÅ‡∏•‡∏∞ delete ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏ñ‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡πÉ‡∏î‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ rollback ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ transaction (`bun.Tx`) ‡∏°‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

- ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏° transaction

```go
tx, err := db.BeginTx(ctx, &sql.TxOptions{})
```

- ‡∏Å‡∏≤‡∏£ commit ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

```go
err := tx.Commit()
```

- ‡∏Å‡∏≤‡∏£ rollback ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î

```go
err := tx.Rollback()
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

```go
func useTx(ctx context.Context, db *bun.DB) error {
	task := Task{
		Text: "do something",
	}

	tx, err := db.BeginTx(ctx, &sql.TxOptions{})
	if err != nil {
		return err
	}

	tx.NewInsert().Model(&task).Exec(ctx)

	id := task.ID

	_, err = tx.NewUpdate().
		Model((*Task)(nil)).
		Column("is_done").
		SetColumn("is_done", "?", "done").
		Where("id = ?", id).
		Exec(ctx)

	if err != nil {
		tx.Rollback()
		return err
	}

	tx.Commit()
	return nil
}
```

‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏à‡∏∞ error ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ is_done ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô boolean

```bash
[bun]  16:39:26.977   BEGIN                   846¬µs  BEGIN
[bun]  16:39:26.981   INSERT                2.532ms  INSERT INTO "tasks" ("id", "title", "is_done", "created_at", "updated_at") VALUES (DEFAULT, 'do something', DEFAULT, DEFAULT, DEFAULT) RETURNING "id", "is_done", "created_at", "updated_at"
[bun]  16:39:26.986   UPDATE                3.531ms  UPDATE "tasks" AS "task" SET is_done = 'done' WHERE (id = 17)        pgdriver.Error: ERROR: invalid input syntax for type boolean: "done" (SQLSTATE=22P02)
[bun]  16:39:26.988   ROLLBACK              1.513ms  ROLLBACK
```

‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å rollback ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ

---

## ‡∏™‡∏£‡∏∏‡∏õ

‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Bun ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° SQL Builder + sqlx + Relations ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠

- Bun ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô SQL queries
- Bun ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Marshal rows ‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô `structs, maps, slices` ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô [sqlx](http://jmoiron.github.io/sqlx/)
- ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Model relationships ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô ORM ‡∏≠‡∏∑‡πà‡∏ô‡πÜ

‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á ‡∏Ñ‡∏∑‡∏≠ comunity ‡∏Ñ‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å‡πÜ ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡∏´‡∏≤‡∏Ñ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢
