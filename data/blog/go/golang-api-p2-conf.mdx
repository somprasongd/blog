---
title: 'API Service with Go: Configuration'
date: '2022-02-02'
lastmod: '2022-07-18'
tags: ['api', 'go', 'env']
draft: false
summary: '‡∏Ñ‡πà‡∏≤ configurations ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏£‡∏á‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏°‡∏µ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£'
---

# Configuration

‡∏Ñ‡πà‡∏≤ configurations ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡πÄ‡∏ä‡πà‡∏ô server port ‡πÅ‡∏•‡∏∞ dsn ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ï‡∏£‡∏á‡πÜ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ environments ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ deploy

‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ environment ‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å `os.Getenv("KEY")`

```go
// starting server
port := os.Getenv("APP_PORT")
log.Printf("Starting server at port %v\n", port)
log.Fatal(http.ListenAndServe(fmt.Sprintf(":%v", port), handler))
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ `APP_PORT` ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏°‡∏≠ ‡πÅ‡∏•‡∏∞‡∏ñ‡πâ‡∏≤‡∏°‡∏µ environment ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

```bash
$ APP_PORT=8081 go run .
2022/02/02 10:10:52 Starting server at port 8081
```

### ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÅ‡∏ô‡πà‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πá‡∏≠‡∏≤‡∏à‡πÉ‡∏™‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ö‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á

‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô utility function‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ default ‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

```go:util/env.go
package util

import (
	"os"
	"strconv"
)

func GetEnv(key string, defaultValue string) string {
	val, ok := os.LookupEnv(key)
	if !ok {
		return defaultValue
	}
	return val
}

func GetEnvInt(key string, defaultValue int) int {
	val, ok := os.LookupEnv(key)
	if !ok {
		return defaultValue
	}
	v, err := strconv.Atoi(val)
	if err != nil {
		return defaultValue
	}
	return v
}

func GetEnvBool(key string, defaultValue bool) bool {
	val, ok := os.LookupEnv(key)
	if !ok {
		return defaultValue
	}
	v, err := strconv.ParseBool(val)
	if err != nil {
		return defaultValue
	}
	return v
}
```

‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

```go
// starting server
port := util.GetEnvInt("APP_PORT", 8080)
log.Printf("Starting server at port %v\n", port)
log.Fatal(http.ListenAndServe(fmt.Sprintf(":%v", port), handler))
```

‡πÅ‡∏ï‡πà‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡∏Å‡πá‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ default ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ ‡∏Ñ‡∏∑‡∏≠ ‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô config ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ deploy ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏Å‡πá‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏≤‡∏Å environment

package ‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ô ‡∏Ñ‡∏∑‡∏≠ [godotenv](https://github.com/joho/godotenv) ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö key=value ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô [viper](https://github.com/spf13/viper) ‡πÅ‡∏ó‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ config ‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏ä‡πà‡∏ô yaml

- ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á viper `go get github.com/spf13/viper`
- ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ config ‡∏•‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `config.yaml` ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ

```yaml
app:
  port: 8080

db:
  driver: 'postgres'
  host: 'john.db.elephantsql.com'
  port: 5432
  username: 'fcricryh'
  password: 'F5a7wATfocTUNww1Dm14AfebtPaysqIn'
  database: 'fcricryh'
```

- ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå config ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå `config/config.go`

```go:config/config.go
package config

import (
	"fmt"
	"strings"

	"github.com/spf13/viper"
)

func LoadConfig() {
	viper.SetConfigName("config")                          // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå config (without extension)
	viper.SetConfigType("yaml")                            // ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config
	viper.AddConfigPath(".")                               // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà working directory

	err := viper.ReadInConfig() // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	if err != nil {             // ‡∏ñ‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ panic ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
		panic(fmt.Errorf("fatal error config file: %w", err))
	}
}
```

- ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÉ‡∏ä‡πâ `viper.GetXXX("‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ . dot notation")`

```go:main.go
func main() {
	config.LoadConfig()
	database.ConnectDB()
  // ...
	// starting server
	port := viper.GetInt("app.port")
	log.Printf("Starting server at port %v\n", port)
	log.Fatal(http.ListenAndServe(fmt.Sprintf(":%v", port), handler))
}
```

- ‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ deploy ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ environment ‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö `APP_PORT` ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° config ‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ environment ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà `panic` ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå config

```go:config/config.go
func init() {
	viper.SetConfigName("config")                          // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå config (without extension)
	viper.SetConfigType("yaml")                            // ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config
	viper.AddConfigPath(".")                               // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà working directory
	viper.AutomaticEnv()                                   // ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å env ‡∏°‡∏≤ replace ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	viper.SetEnvKeyReplacer(strings.NewReplacer(".", "_")) // ‡πÅ‡∏õ‡∏•‡∏á _ underscore ‡πÉ‡∏ô env ‡πÄ‡∏õ‡πá‡∏ô . dot notation ‡πÉ‡∏ô viper

	err := viper.ReadInConfig() // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	if err != nil {             // ‡∏ñ‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å env ‡∏°‡∏≤‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ
		fmt.Println("please consider environment variables", err.Error())
	}
}

// APP_PORT=8081 go run .
```

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ default ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏ app.port ‡∏°‡∏≤ ‡πÉ‡∏´‡πâ default ‡πÄ‡∏õ‡πá‡∏ô 8080

```go:config/config.go
func LoadConfig() {
	viper.SetConfigName("config")                          // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå config (without extension)
	viper.SetConfigType("yaml")                            // ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config
	viper.AddConfigPath(".")                               // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà working directory
	viper.AutomaticEnv()                                   // ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å env ‡∏°‡∏≤ replace ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	viper.SetEnvKeyReplacer(strings.NewReplacer(".", "_")) // ‡πÅ‡∏õ‡∏•‡∏á _ underscore ‡πÉ‡∏ô env ‡πÄ‡∏õ‡πá‡∏ô . dot notation ‡πÉ‡∏ô viper

	err := viper.ReadInConfig() // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	if err != nil {             // ‡∏ñ‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å env ‡∏°‡∏≤‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ
		fmt.Println("please consider environment variables", err.Error())
	}

  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Default Value
	viper.SetDefault("app.port", 8080)
}
```

- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á struct ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ config ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ

```go:config/config.go
package config

import (
	"fmt"
	"log"
	"strings"

	"github.com/spf13/viper"
)

type configuration struct {
	App appConfig
	Db  dbConfig
}

type appConfig struct {
	Port uint
}

type dbConfig struct {
	Driver   string
	Host     string
	Port     uint
	Username string
	Password string
	Database string
}

var Config *configuration

func LoadConfig() {
	viper.SetConfigName("config")                          // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå config (without extension)
	viper.SetConfigType("yaml")                            // ‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config
	viper.AddConfigPath(".")                               // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå config ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà working directory
	viper.AutomaticEnv()                                   // ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å env ‡∏°‡∏≤ replace ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	viper.SetEnvKeyReplacer(strings.NewReplacer(".", "_")) // ‡πÅ‡∏õ‡∏•‡∏á _ underscore ‡πÉ‡∏ô env ‡πÄ‡∏õ‡πá‡∏ô . dot notation ‡πÉ‡∏ô viper

	err := viper.ReadInConfig() // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config
	if err != nil {             // ‡∏ñ‡πâ‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå config ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å env ‡∏°‡∏≤‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ
		fmt.Println("please consider environment variables", err.Error())
	}

	// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Default Value
	viper.SetDefault("app.port", 8080)

	// Decode config ‡∏î‡πâ‡∏ß‡∏¢ Unmarshling
	Config = &configuration{}
	err = viper.Unmarshal(Config)
	if err != nil {
		log.Fatalf("unable to decode config into struct, %v", err)
	}
}
```

<aside>
üí° ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô struct ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ `port := config.Config.App.Port`

</aside>

- ‡πÅ‡∏ï‡πà ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ ‡∏Å‡∏≤‡∏£ Decode config ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ Unmarshling ‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ config ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤ environments ‡∏ú‡πà‡∏≤‡∏ô `viper.AutomaticEnv()` ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á struct Config ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏≠‡∏á‡πÅ‡∏ó‡∏ô

```go:config/config.go
func LoadConfig() {
	// ...

	// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Default Value
	viper.SetDefault("app.port", 8080)

	Config = &configuration{
		App: appConfig{
			Port: viper.GetUint("app.port"),
		},
		Db: dbConfig{
			Driver:   viper.GetString("db.driver"),
			Host:     viper.GetString("db.host"),
			Port:     viper.GetUint("db.port"),
			Username: viper.GetString("db.username"),
			Password: viper.GetString("db.password"),
			Database: viper.GetString("db.database"),
		},
  }
  // err = viper.Unmarshal(Config)
	// if err != nil {
	// 	log.Fatalf("unable to decode config into struct, %v", err)
	// }
}
```

- ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ config ‡∏°‡∏≤‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ [validator](https://github.com/go-playground/validator)

```go:config/config.go
func LoadConfig() {
  // ...

	// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
	validate := validator.New()

	err = validate.Struct(Config)
	if err != nil {
		log.Fatalf("load config error, %v", err)
	}
}
```

- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

```go:main.go
func main() {
	config.LoadConfig()
	database.ConnectDB()
  // ...
	// starting server
	port := config.Config.App.Port
	log.Printf("Starting server at port %v\n", port)
	log.Fatal(http.ListenAndServe(fmt.Sprintf(":%v", port), handler))
}
```

## ‡∏™‡∏£‡∏∏‡∏õ

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ configurations ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å environments ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏¢‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡∏±‡∏ö configurations ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤ push ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏∂‡πâ‡∏ô git ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö ‡πÄ‡∏ä‡πà‡∏ô apikey ‡∏´‡∏£‡∏∑‡∏≠ database password ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏´‡∏•‡∏∏‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ

‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤ configurations ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ deploy ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏≠‡∏¥‡∏™‡∏£‡∏∞ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
