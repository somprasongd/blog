---
title: 'API Service with Go: Logging'
date: '2022-02-05'
lastmod: '2022-08-15'
tags: ['api', 'go', 'log']
draft: false
summary: '‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á log ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£'
---

# Logging

‡πÉ‡∏ô‡∏†‡∏≤‡∏©‡∏≤ Go ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ log ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ `fmt.Println()` ‡∏´‡∏£‡∏∑‡∏≠ `log.Println()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ô‡∏≥‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏•‡∏≥‡∏ö‡∏≤‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ê‡∏≤‡∏ô ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ log ‡∏ó‡∏µ‡πà‡∏î‡∏µ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£ log ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ microservices ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≠‡∏ô‡πÜ ‡∏Å‡∏±‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡πÜ ‡∏ï‡∏±‡∏ß ‡∏Å‡πá‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ uniquie id ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏õ log ‡∏Ç‡∏≠‡∏á request ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏Å‡πá‡∏à‡∏∞‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

## ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Unique ID

‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô microservices ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å service ‡∏Å‡∏±‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á log ‡πÅ‡∏Ñ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏π‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤ log ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á request ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏ä‡πà‡∏ô Request ID ‡∏´‡∏£‡∏∑‡∏≠ Transaction ID ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£ Tracing ‡∏Å‡πá‡∏Ñ‡∏ß‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á TraceID ‡πÅ‡∏•‡∏∞ SpanID ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏ï‡∏±‡∏ß‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ö‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô request ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏Å‡πá‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ log ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Transaction ID

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏´‡πâ Client ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ unique id ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ó‡∏≤‡∏á Request Header ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ `X-Trasaction-Id` ‡πÅ‡∏•‡πâ‡∏ß‡∏ù‡∏±‡πà‡∏á Server ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô log ‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô

```go:pkg/handlers/todo.go
func CreateTodoHandler(w http.ResponseWriter, r *http.Request) {
	// ...
  tx := database.DB.Create(&todo)
  if err := tx.Error; err != nil {
		appErr := errs.NewUnexpectedError(err.Error())
		if errors.Is(err, gorm.ErrRecordNotFound) {
			appErr = errs.NewNotFoundError("todo with given id not found")
		}
	  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á X-Trasaction-Id ‡πÄ‡∏õ‡πá‡∏ô uuid ‡∏°‡∏≤‡πÉ‡∏ô request header
		txId := r.Header.Get("X-Transaction-Id")
		log.Println(txId, appErr.Message)
		w.Header().Add("Content-Type", "application/json")
		w.WriteHeader(appErr.Code)
		json.NewEncoder(w).Encode(appErr)
		return
	}
  // ...
}

// 2022/02/01 11:07:10 833d57ef-afb9-45c1-8450-9eff6559043e todo with given id not found
```

## ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á **Log**

‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏≤‡πÅ‡∏™‡∏î‡∏á log ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ELK ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡∏•‡∏≥‡∏ö‡∏≤‡∏Å ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡πá‡∏¢‡∏≤‡∏Å ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á log ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÅ‡∏ó‡∏ô ‡πÄ‡∏ä‡πà‡∏ô

```go
2022/02/01 11:07:10 833d57ef-afb9-45c1-8450-9eff6559043e todo with given id not found

‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô

{
  "timestamp": "2022/02/01 11:07:10",
  "transactionId": "833d57ef-afb9-45c1-8450-9eff6559043e",
  "message": "todo with given id not found"
}
```

‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ key ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏°‡∏µ package ‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà 2 ‡∏ï‡∏±‡∏ß ‡∏Ñ‡∏∑‡∏≠ [zap](https://github.com/uber-go/zap) ‡∏Å‡∏±‡∏ö [logrus](https://github.com/sirupsen/logrus) ‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ zap

```bash
go get -u go.uber.org/zap
```

### Logger Module

‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á logger module ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

```go:pkg/common/logger/logger.go
package logger

import (
	"fmt"

	"go.uber.org/zap"
)

var zlog *zap.Logger

func init() {
	var err error

	zlog, err = zap.NewProduction()

	if err != nil {
		panic(err)
	}
}

func Info(message string, fileds ...zap.Field) {
	zlog.Info(message, fileds...)
}

func Debug(message string, fileds ...zap.Field) {
	zlog.Debug(message, fileds...)
}

func Error(message string, fileds ...zap.Field) {
	zlog.Error(message, fileds...)
}

func Warn(message string, fileds ...zap.Field) {
	zlog.Warn(message, fileds...)
}

func Fatal(message string, fileds ...zap.Field) {
	zlog.Fatal(message, fileds...)
}

func Panic(message string, fileds ...zap.Field) {
	zlog.Panic(message, fileds...)
}
```

‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£ `log.Println()` ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô `logger.Info()` ‡πÅ‡∏ó‡∏ô

```go:cmd/main.go
func main() {
  // ...
  logger.Info("Starting server at port 8080")
	log.Fatal(http.ListenAndServe(":8080", handler))
}

// {"level":"info","ts":1643702027.675124,"caller":"logger/logger.go:20","msg":"Starting server at port 8080"}
```

<aside>
üí° ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà caller ‡∏ô‡∏±‡πà‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢ `zap.NewProduction(zap.AddCallerSkip(1))` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô log ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

</aside>

```diff:pkg/common/logger/logger.go
func init() {
	var err error

- log, err = zap.NewProduction()
+	log, err = zap.NewProduction(zap.AddCallerSkip(1))

	if err != nil {
		panic(err)
	}
}
```

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ

- **‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ field** ‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ field ‡πÄ‡∏ä‡πà‡∏ô `ts` ‡πÄ‡∏õ‡πá‡∏ô `timestamp` ‡πÅ‡∏•‡∏∞‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô format ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡πÇ‡∏î‡∏¢ `key = "NewKeyName"`

```go:pkg/common/logger/logger.go
func init() {
	var err error

	encoderConfig := zap.NewProductionEncoderConfig()
	encoderConfig.TimeKey = "timestamp"
	encoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder

	config := zap.NewProductionConfig()
	config.EncoderConfig = encoderConfig

	log, err = config.Build(zap.AddCallerSkip(1))

	if err != nil {
		panic(err)
	}
}
// {"level":"info","timestamp":"2022-02-01T15:04:40.736+0700","caller":"goapi/main.go:39","msg":"Starting server at port 8080"}
```

- **‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á key ‡πÑ‡∏´‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà `key = ""` ‡πÄ‡∏ä‡πà‡∏ô `encoderConfig.StacktraceKey = ""` ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `StacktraceKey` ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
- **Dev mode** ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡∏π‡πà ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á log ‡πÅ‡∏ö‡∏ö json ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö Development Config ‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ

```diff:pkg/common/logger/logger.go
func init() {
	var err error

  encoderConfig := zap.NewProductionEncoderConfig()
	encoderConfig.TimeKey = "timestamp"
	encoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder

+	mode := os.Getenv("APP_MODE")
+	var config zap.Config
+	if mode == "production" {
+		config = zap.NewProductionConfig()
+	} else {
+		config = zap.NewDevelopmentConfig()
+	}

	config.EncoderConfig = encoderConfig

	log, err = config.Build(zap.AddCallerSkip(1))

	if err != nil {
		panic(err)
	}
}
```

## ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ Elastic Search

‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å log ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Elastic Search ‡∏Å‡πá‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á JSON ‡∏ï‡∏≤‡∏° **Elastic Common Schema (ECS)** ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏µ plugin ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ [ecszap](https://pkg.go.dev/go.elastic.co/ecszap) ‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ format ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏¢

```go:pkg/common/logger/logger.go
// go get go.elastic.co/ecszap

func init() {
	var err error

  mode := os.Getenv("APP_MODE")
	var config zap.Config
	if mode == "production" {
		config = zap.NewProductionConfig()
	} else {
		config = zap.NewDevelopmentConfig()
	}

	config.EncoderConfig = ecszap.ECSCompatibleEncoderConfig(config.EncoderConfig)
	log, err = config.Build(ecszap.WrapCoreOption(), zap.AddCallerSkip(1))

	if err != nil {
		panic(err)
	}
}
```

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô plugin [ecszap](https://pkg.go.dev/go.elastic.co/ecszap) ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏±‡πâ‡∏ô ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ format ‡∏ï‡∏≤‡∏° ECS ‡πÄ‡∏•‡∏¢ ‡πÅ‡∏ï‡πà‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á Transaction ID ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á zap.Field ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á

- ‡∏™‡∏£‡πâ‡∏≤‡∏á filed ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á transactionId ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `zap.String("transactionId", txId)`
- ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏° message

```go:pkg/handlers/todo.go
func CreateTodoHandler(w http.ResponseWriter, r *http.Request) {
	// ...
  tx := database.DB.Create(&todo)
  if err := tx.Error; err != nil {
		appErr := errs.NewUnexpectedError(err.Error())
		if errors.Is(err, gorm.ErrRecordNotFound) {
			appErr = errs.NewNotFoundError("todo with given id not found")
		}
	  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á X-Trasaction-Id ‡πÄ‡∏õ‡πá‡∏ô uuid ‡∏°‡∏≤‡πÉ‡∏ô request header
		txId := r.Header.Get("X-Transaction-Id")
		// ‡∏™‡∏£‡πâ‡∏≤‡∏á field ‡πÉ‡∏´‡∏°‡πà
    txField := zap.String("transactionId", txId)
    // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
		logger.Error(appErr.Message, txField)

		w.Header().Add("Content-Type", "application/json")
		w.WriteHeader(appErr.Code)
		json.NewEncoder(w).Encode(appErr)
		return
	}
  // ...
}
```

## Final logger module

‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î logger module ‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö dev mode ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ Elastic Search ‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏ú‡πà‡∏≤‡∏ô interface ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Logger interface ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ä‡∏∑‡πà‡∏≠ Default ‡πÅ‡∏ó‡∏ô

```go:pkg/common/logger/logger.go
package logger

import (
	"os"

	"go.elastic.co/ecszap"
	"go.uber.org/zap"
	"go.uber.org/zap/zapcore"
)

type Field = zapcore.Field

type Interface interface {
	Info(msg string, fileds ...Field)
	Debug(msg string, fileds ...Field)
	Error(msg string, fileds ...Field)
	Warn(msg string, fileds ...Field)
	Fatal(msg string, fileds ...Field)
	Panic(msg string, fileds ...Field)
}

var zlog *zap.Logger
var Default Interface

func init() {
	var err error

	mode := os.Getenv("APP_MODE")

	var config zap.Config
	if mode == "production" {
		config = zap.NewProductionConfig()
	} else {
		config = zap.NewDevelopmentConfig()
	}

	config.EncoderConfig = ecszap.ECSCompatibleEncoderConfig(config.EncoderConfig)

	zlog, err = config.Build(ecszap.WrapCoreOption(), zap.AddCallerSkip(1))

	if err != nil {
		panic(err)
	}

	Default = newZapLogger(zlog)
}

func New(fileds ...Field) Interface {
	nlog := zlog.With(fileds...)
	return newZapLogger(nlog)
}

func ToFields(source map[string]interface{}) []Field {
	fields := []Field{}
	for k, v := range source {
		fields = append(fields, zap.Any(k, v))
	}
	return fields
}
```

- ‡∏™‡∏£‡πâ‡∏≤‡∏á Logger ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ zap logger

```go:pkg/common/logger/zap.go
package logger

import "go.uber.org/zap"

type zapLogger struct {
	*zap.Logger
}

func newZapLogger(logger *zap.Logger) Interface {
	return &zapLogger{logger}
}

func (l *zapLogger) Info(msg string, fileds ...Field) {
	l.Logger.Info(msg, fileds...)
}

func (l *zapLogger) Debug(msg string, fileds ...Field) {
	l.Logger.Debug(msg, fileds...)
}

func (l *zapLogger) Error(msg string, fileds ...Field) {
	l.Logger.Error(msg, fileds...)
}

func (l *zapLogger) Warn(msg string, fileds ...Field) {
	l.Logger.Warn(msg, fileds...)
}

func (l *zapLogger) Fatal(msg string, fileds ...Field) {
	l.Logger.Fatal(msg, fileds...)
}

func (l *zapLogger) Panic(msg string, fileds ...Field) {
	l.Logger.Panic(msg, fileds...)
}
```

- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô logger module ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô `logger.Default` ‡πÄ‡∏ä‡πà‡∏ô

```go:cmd/main.go
func main() {
  // ...
  logger.Default.Info("Starting server at port 8080")
	log.Fatal(http.ListenAndServe(":8080", handler))
}
```

- ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° fields ‡πÄ‡∏ä‡πà‡∏ô `transactionId` ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô `map[string]interface{}` ‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô

```go:pkg/handlers/todo.go
func CreateTodoHandler(w http.ResponseWriter, r *http.Request) {
	// ...
  tx := database.DB.Create(&todo)
  if err := tx.Error; err != nil {
		appErr := errs.NewUnexpectedError(err.Error())
		if errors.Is(err, gorm.ErrRecordNotFound) {
			appErr = errs.NewNotFoundError("todo with given id not found")
		}
	  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á X-Trasaction-Id ‡πÄ‡∏õ‡πá‡∏ô uuid ‡∏°‡∏≤‡πÉ‡∏ô request header
		txId := r.Header.Get("X-Transaction-Id")
		// ‡∏™‡∏£‡πâ‡∏≤‡∏á field ‡πÉ‡∏´‡∏°‡πà
    fields := map[string]interface{}{}
		fields["transactionId"] = txId
    // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
		logger.Default.Error(appErr.Message, logger.ToFields(fields)...)

		w.Header().Add("Content-Type", "application/json")
		w.WriteHeader(appErr.Code)
		json.NewEncoder(w).Encode(appErr)
		return
	}
  // ...
}
```
